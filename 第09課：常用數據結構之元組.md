## 第09課：常用數據結構之元組

上一節課為大家講解了Python中的列表，它是一種容器型數據類型，我們可以通過定義列表類型的變量來保存和操作多個元素。當然，Python中容器型的數據類型肯定不止列表一種，接下來我們為大家講解另一種重要的容器型數據類型，它的名字叫元組（tuple）。

### 定義和使用元組

在Python中，元組也是多個元素按照一定的順序構成的序列。元組和列表的不同之處在於，元組是不可變類型，這就意味著元組類型的變量一旦定義，其中的元素不能再添加或刪除，而且元素的值也不能進行修改。定義元組通常使用`()`字面量語法，也建議大家使用這種方式來創建元組。元組類型支持的運算符跟列表是一樣。下面的代碼演示了元組的定義和運算。

```Python
# 定義一個三元組
t1 = (30, 10, 55)
# 定義一個四元組
t2 = ('駱昊', 40, True, '四川成都')

# 查看變量的類型
print(type(t1), type(t2))    # <class 'tuple'> <class 'tuple'>
# 查看元組中元素的數量
print(len(t1), len(t2))      # 3 4

# 通過索引運算獲取元組中的元素
print(t1[0], t1[-3])         # 30 30
print(t2[3], t2[-1])         # 四川成都 四川成都

# 循環遍曆元組中的元素
for member in t2:
    print(member)

# 成員運算
print(100 in t1)    # False
print(40 in t2)     # True

# 拼接
t3 = t1 + t2
print(t3)           # (30, 10, 55, '駱昊', 40, True, '四川成都')

# 切片
print(t3[::3])      # (30, '駱昊', '四川成都')

# 比較運算
print(t1 == t3)    # False
print(t1 >= t3)    # False
print(t1 < (30, 11, 55))    # True
```

一個元組中如果有兩個元素，我們就稱之為二元組；一個元組中如果五個元素，我們就稱之為五元組。需要提醒大家注意的是，`()`表示空元組，但是如果元組中只有一個元素，需要加上一個逗號，否則`()`就不是代表元組的字面量語法，而是改變運算優先級的圓括號，所以`('hello', )`和`(100, )`才是一元組，而`('hello')`和`(100)`只是字符串和整數。我們可以通過下面的代碼來加以驗證。

```Python
# 空元組
a = ()
print(type(a))    # <class 'tuple'>
# 不是元組
b = ('hello')
print(type(b))    # <class 'str'>
c = (100)
print(type(c))    # <class 'int'>
# 一元組
d = ('hello', )
print(type(d))    # <class 'tuple'>
e = (100, )
print(type(e))    # <class 'tuple'>
```

### 元組的應用場景

講到這裡，相信大家一定迫切的想知道元組有哪些應用場景，我們給大家舉幾個例子。

#### 例子1：打包和解包操作。

當我們把多個用逗號分隔的值賦給一個變量時，多個值會打包成一個元組類型；當我們把一個元組賦值給多個變量時，元組會解包成多個值然後分別賦給對應的變量，如下面的代碼所示。

```Python
# 打包
a = 1, 10, 100
print(type(a), a)    # <class 'tuple'> (1, 10, 100)
# 解包
i, j, k = a
print(i, j, k)       # 1 10 100
```

在解包時，如果解包出來的元素個數和變量個數不對應，會引發`ValueError`異常，錯誤信息為：`too many values to unpack`（解包的值太多）或`not enough values to unpack`（解包的值不足）。

```Python
a = 1, 10, 100, 1000
# i, j, k = a             # ValueError: too many values to unpack (expected 3)
# i, j, k, l, m, n = a    # ValueError: not enough values to unpack (expected 6, got 4)
```

有一種解決變量個數少於元素的個數方法，就是使用星號表達式，我們之前講函數的可變參數時使用過星號表達式。有了星號表達式，我們就可以讓一個變量接收多個值，代碼如下所示。需要注意的是，用星號表達式修飾的變量會變成一個列表，列表中有0個或多個元素。還有在解包語法中，星號表達式只能出現一次。

```Python
a = 1, 10, 100, 1000
i, j, *k = a
print(i, j, k)          # 1 10 [100, 1000]
i, *j, k = a
print(i, j, k)          # 1 [10, 100] 1000
*i, j, k = a
print(i, j, k)          # [1, 10] 100 1000
*i, j = a
print(i, j)             # [1, 10, 100] 1000
i, *j = a
print(i, j)             # 1 [10, 100, 1000]
i, j, k, *l = a
print(i, j, k, l)       # 1 10 100 [1000]
i, j, k, l, *m = a
print(i, j, k, l, m)    # 1 10 100 1000 []
```

需要說明一點，解包語法對所有的序列都成立，這就意味著對列表以及我們之前講到的`range`函數返回的範圍序列都可以使用解包語法。大家可以嘗試運行下面的代碼，看看會出現怎樣的結果。

```Python
a, b, *c = range(1, 10)
print(a, b, c)
a, b, c = [1, 10, 100]
print(a, b, c)
a, *b, c = 'hello'
print(a, b, c)
```

#### 例子2：交換兩個變量的值。

交換兩個變量的值是編程語言中的一個經典案例，在很多編程語言中，交換兩個變量的值都需要藉助一個中間變量才能做到，如果不用中間變量就需要使用比較晦澀的位運算來實現。在Python中，交換兩個變量`a`和`b`的值只需要使用如下所示的代碼。

```Python
a, b = b, a
```

同理，如果要將三個變量`a`、`b`、`c`的值互換，即`b`賦給`a`，`c`賦給`b`，`a`賦給`c`，也可以如法炮製。

```Python
a, b, c = b, c, a
```

需要說明的是，上面並沒有用到打包和解包語法，Python的字節碼指令中有`ROT_TWO`和`ROT_THREE`這樣的指令可以實現這個操作，效率是非常高的。但是如果有多於三個變量的值要依次互換，這個時候沒有直接可用的字節碼指令，執行的原理就是我們上面講解的打包和解包操作。

### 元組和列表的比較

這裡還有一個非常值得探討的問題，Python中已經有了列表類型，為什麼還需要元組這樣的類型呢？這個問題對於初學者來說似乎有點困難，不過沒有關係，我們先拋出觀點，大家可以一邊學習一邊慢慢體會。

1. 元組是不可變類型，**不可變類型更適合多線程環境**，因為它降低了並發訪問變量的同步化開銷。關於這一點，我們會在後面講解多線程的時候為大家詳細論述。

2. 元組是不可變類型，通常**不可變類型在創建時間和占用空間上面都優於對應的可變類型**。我們可以使用`sys`模塊的`getsizeof`函數來檢查保存相同元素的元組和列表各自佔用了多少內存空間。我們也可以使用`timeit`模塊的`timeit`函數來看看創建保存相同元素的元組和列表各自花費的時間，代碼如下所示。

   ```Python
   import sys
   import timeit
   
   a = list(range(100000))
   b = tuple(range(100000))
   print(sys.getsizeof(a), sys.getsizeof(b))    # 900120 800056
   
   print(timeit.timeit('[1, 2, 3, 4, 5, 6, 7, 8, 9]'))
   print(timeit.timeit('(1, 2, 3, 4, 5, 6, 7, 8, 9)'))
   ```

3. Python中的元組和列表是可以相互轉換的，我們可以通過下面的代碼來做到。

   ```Python
   # 將元組轉換成列表
   info = ('駱昊', 175, True, '四川成都')
   print(list(info))       # ['駱昊', 175, True, '四川成都']
   # 將列表轉換成元組
   fruits = ['apple', 'banana', 'orange']
   print(tuple(fruits))    # ('apple', 'banana', 'orange')
   ```

### 簡單的總結

**列表和元組都是容器型的數據類型**，即一個變量可以保存多個數據。 **列表是可變數據類型**，**元組是不可變數據類型**，所以列表添加元素、刪除元素、清空、排序等方法對於元組來說是不成立的。但是列表和元組都可以進行**拼接**、**成員運算**、**索引和切片**這些操作，後面我們要講到的字符串類型也是這樣，因為字符串就是字符按一定順序構成的序列，在這一點上三者並沒有什麼區別。我們**推薦大家使用列表的生成式語法來創建列表**，它很好用，也是Python中非常有特色的語法。

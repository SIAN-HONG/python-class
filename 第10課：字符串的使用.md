## 第10課：字符串的使用

第二次世界大戰促使了現代電子計算機的誕生，世界上的第一台通用電子計算機叫ENIAC（電子數值積分計算機），誕生於美國的賓夕法尼亞大學，佔地167平米，重量27噸，每秒鐘大約能夠完成約5000次浮點運算，如下圖所示。 ENIAC誕生之後被應用於導彈彈道的計算，而數值計算也是現代電子計算機最為重要的一項功能。

<img src="https://gitee.com/jackfrued/mypic/raw/master/20210727163610.jpg" width="65%">

隨著時間的推移，雖然數值運算仍然是計算機日常工作中最為重要的組成部分，但是今天的計算機還要處理大量的以文本形式存在的信息。如果我們希望通過Python程序來操作本這些文本信息，就必須要先了解字符串這種數據類型以及與它相關的知識。

### 字符串的定義

所謂**字符串**，就是**由零個或多個字符組成的有限序列**，一般記為：
$$
s = a_1a_2 \cdots a_n \,\,\,\,\, (0 \le n \le \infty)
$$
在Python程序中，如果我們把單個或多個字符用單引號或者雙引號包圍起來，就可以表示一個字符串。字符串中的字符可以是特殊符號、英文字母、中文字符、日文的平假名或片假名、希臘字母、[Emoji字符](<http://www.ruanyifeng.com/blog/2017/04/emoji.html>)等。

```Python
s1 = 'hello, world!'
s2 = "你好，世界！"
print(s1, s2)
# 以三個雙引號或單引號開頭的字符串可以折行
s3 = '''
hello, 
world!
'''
print(s3, end='')
```

> **提示**：`print`函數中的`end=''`表示輸出後不換行，即將默認的結束符`\n`（換行符）更換為`''`（空字符）。

### 轉義字符和原始字符串

可以在字符串中使用`\`（反斜杠）來表示轉義，也就是說`\`後面的字符不再是它原來的意義，例如：`\n`不是代表反斜杠和字符`n`，而是表示換行；`\t`也不是代表反斜杠和字符`t`，而是表示製表符。所以如果字符串本身又包含了`'`、`"`、`\`這些特殊的字符，必須要通過`\`進行轉義處理。例如要輸出一個帶單引號或反斜杠的字符串，需要用如下所示的方法。

```Python
s1 = '\'hello, world!\''
print(s1)
s2 = '\\hello, world!\\'
print(s2)
```

Python中的字符串可以`r`或`R`開頭，這種字符串被稱為原始字符串，意思是字符串中的每個字符都是它本來的含義，沒有所謂的轉義字符。例如，在字符串`'hello\n'`中，`\n`表示換行；而在`r'hello\n'`中，`\n`不再表示換行，就是反斜杠和字符`n`。大家可以運行下面的代碼，看看會輸出什麼。

```Python
# 字符串s1中\t是製表符，\n是換行符
s1 = '\time up \now'
print(s1)
# 字符串s2中沒有轉義字符，每個字符都是原始含義
s2 = r'\time up \now'
print(s2)
```

Python中還允許在`\`後面還可以跟一個八進製或者十六進制數來表示字符，例如`\141`和`\x61`都代表小寫字母`a`，前者是八進制的表示法，後者是十六進制的表示法。另外一種表示字符的方式是在`\u`後面跟Unicode字符編碼，例如`\u4f60\u597d`代表的是中文“你好”。運行下面的代碼，看看輸出了什麼。

```Python
s1 = '\141\142\143\x61\x62\x63'
s2 = '\u4f60\u597d'
print(s1, s2)
```

### 字符串的運算

Python為字符串類型提供了非常豐富的運算符，我們可以使用`+`運算符來實現字符串的拼接，可以使用`*`運算符來重複一個字符串的內容，可以使用`in`和`not in`來判斷一個字符串是否包含另外一個字符串，我們也可以用`[]`和`[:]`運算符從字符串取出某個字符或某些字符。

#### 拼接和重複

下面的例子演示了使用`+`和`*`運算符來實現字符串的拼接和重複操作。

```Python
s1 = 'hello' + ' ' + 'world'
print(s1)    # hello world
s2 = '!' * 3
print(s2)    # !!!
s1 += s2     # s1 = s1 + s2
print(s1)    # hello world!!!
s1 *= 2      # s1 = s1 * 2
print(s1)    # hello world!!!hello world!!!
```

用`*`實現字符串的重複是非常有意思的一個運算符，在很多編程語言中，要表示一個有10個`a`的字符串，你只能寫成`"aaaaaaaaaa"`，但是在Python中，你可以寫成`'a' * 10`。你可能覺得`"aaaaaaaaaa"`這種寫法也沒有什麼不方便的，那麼想一想，如果字符`a`要重複100次或者1000次又會如何呢？

#### 比較運算

對於兩個字符串類型的變量，可以直接使用比較運算符比較兩個字符串的相等性或大小。需要說明的是，因為字符串在計算機內存中也是以二進制形式存在的，那麼字符串的大小比較比的是每個字符對應的編碼的大小。例如`A`的編碼是`65`， 而`a`的編碼是`97`，所以`'A' < 'a'`的結果相當於就是`65 < 97`的結果，很顯然是`True`；而`'boy' < 'bad'`，因為第一個字符都是`'b'`比不出大小，所以實際比較的是第二個字符的大小，顯然`'o' < 'a'`的結果是`False`，所以`'boy' < 'bad'`的結果也是`False`。如果不清楚兩個字符對應的編碼到底是多少，可以使用`ord`函數來獲得，例如`ord('A')`的值是`65`，而`ord('昊')`的值是`26122`。下面的代碼為大家展示了字符串的比較運算。

```Python
s1 = 'a whole new world'
s2 = 'hello world'
print(s1 == s2, s1 < s2)      # False True
print(s2 == 'hello world')    # True
print(s2 == 'Hello world')    # False
print(s2 != 'Hello world')    # True
s3 = '駱昊'
print(ord('駱'), ord('昊'))               # 39558 26122
s4 = '王大錘'
print(ord('王'), ord('大'), ord('錘'))    # 29579 22823 38180
print(s3 > s4, s3 <= s4)      # True False
```

需要強調一下的是，字符串的比較運算比較的是字符串的內容，Python中還有一個`is`運算符（身份運算符），如果用`is`來比較兩個字符串，它比較的是兩個變量對應的字符串對象的內存地址（不理解先跳過），簡單的說就是兩個變量是否對應內存中的同一個字符串。看看下面的代碼就比較清楚`is`運算符的作用了。

```Python
s1 = 'hello world'
s2 = 'hello world'
s3 = s2
# 比較字符串的內容
print(s1 == s2, s2 == s3)    # True True
# 比較字符串的內存地址
print(s1 is s2, s2 is s3)    # False True
```

#### 成員運算

Python中可以用`in`和`not in`判斷一個字符串中是否存在另外一個字符或字符串，`in`和`not in`運算通常稱為成員運算，會產生布爾值`True`或`False`，代碼如下所示。

```Python
s1 = 'hello, world'
print('wo' in s1)    # True
s2 = 'goodbye'
print(s2 in s1)      # False
```

#### 獲取字符串長度

獲取字符串長度沒有直接的運算符，而是使用內置函數`len`，我們在上節課的提到過這個內置函數，代碼如下所示。

```Python
s = 'hello, world'
print(len(s))                   # 12
print(len('goodbye, world'))    # 14
```

#### 索引和切片

如果希望從字符串中取出某個字符，我們可以對字符串進行索引運算，運算符是`[n]`，其中`n`是一個整數，假設字符串的長度為`N`，那麼`n`可以是從`0`到`N-1`的整數，其中`0`是字符串中第一個字符的索引，而`N-1`是字符串中最後一個字符的索引，通常稱之為正向索引；在Python中，字符串的索引也可以是從`-1`到`-N`的整數，其中`-1`是最後一個字符的索引，而`-N`則是第一個字符的索引，通常稱之為負向索引。注意，因為**字符串是不可變類型**，所以**不能通過索引運算修改字符串中的字符**。

```Python
s = 'abc123456'
N = len(s)

# 獲取第一個字符
print(s[0], s[-N])    # a a

# 獲取最後一個字符
print(s[N-1], s[-1])  # 6 6

# 獲取索引為2或-7的字符
print(s[2], s[-7])    # c c

# 獲取索引為5和-4的字符
print(s[5], s[-4])    # 3 3
```

需要提醒大家注意的是，在進行索引操作時，如果索引越界（正向索引不在`0`到`N-1`範圍，負向索引不在`-1`到`-N`範圍），會引發`IndexError`異常，錯誤提示信息為：`string index out of range`（字符串索引超出範圍）。

如果要從字符串中取出多個字符，我們可以對字符串進行切片，運算符是`[i:j:k]`，其中`i`是開始索引，索引對應的字符可以取到；`j`是結束索引，索引對應的字符不能取到；`k`是步長，默認值為`1`，表示從前向後獲取相鄰字符的連續切片，所以`:k`部分可以省略。假設字符串的長度為`N`，當`k > 0`時表示正向切片（從前向後獲取字符），如果沒有給出`i`和`j`的值，則`i`的默認值是`0`，`j`的默認值是`N`；當`k < 0`時表示負向切片（從後向前獲取字符），如果沒有給出`i`和`j`的值，則`i`的默認值是`-1`，j的默認值是`-N - 1`。如果不理解，直接看下面的例子，記住第一個字符的索引是`0`或`-N`，最後一個字符的索引是`N-1`或`-1`就行了。

```Python
s = 'abc123456'

# i=2, j=5, k=1的正向切片操作
print(s[2:5])       # c12

# i=-7, j=-4, k=1的正向切片操作
print(s[-7:-4])     # c12

# i=2, j=9, k=1的正向切片操作
print(s[2:])        # c123456

# i=-7, j=9, k=1的正向切片操作
print(s[-7:])       # c123456

# i=2, j=9, k=2的正向切片操作
print(s[2::2])      # c246

# i=-7, j=9, k=2的正向切片操作
print(s[-7::2])     # c246

# i=0, j=9, k=2的正向切片操作
print(s[::2])       # ac246

# i=1, j=-1, k=2的正向切片操作
print(s[1:-1:2])    # b135

# i=7, j=1, k=-1的負向切片操作
print(s[7:1:-1])    # 54321c

# i=-2, j=-8, k=-1的負向切片操作
print(s[-2:-8:-1])  # 54321c

# i=7, j=-10, k=-1的負向切片操作
print(s[7::-1])     # 54321cba

# i=-1, j=1, k=-1的負向切片操作
print(s[:1:-1])     # 654321c

# i=0, j=9, k=1的正向切片
print(s[:])         # abc123456

# i=0, j=9, k=2的正向切片
print(s[::2])       # ac246

# i=-1, j=-10, k=-1的負向切片
print(s[::-1])      # 654321cba

# i=-1, j=-10, k=-2的負向切片
print(s[::-2])      # 642ca
```

#### 循環遍歷每個字符

如果希望從字符串中取出每個字符，可以使用`for`循環對字符串進行遍歷，有兩種方式。

方式一：

```Python
s1 = 'hello'
for index in range(len(s1)):
    print(s1[index])
```

方式二：

```Python
s1 = 'hello'
for ch in s1:
    print(ch)
```

### 字符串的方法

在Python中，我們可以通過字符串類型自帶的方法對字符串進行操作和處理，對於一個字符串類型的變量，我們可以用`變量名.方法名()`的方式來調用它的方法。所謂方法其實就是跟某個類型的變量綁定的函數，後面我們講面向對象編程的時候還會對這一概念詳加說明。

#### 大小寫相關操作

下面的代碼演示了和字符串大小寫變換相關的方法。

```Python
s1 = 'hello, world!'

# 使用capitalize方法獲得字符串首字母大寫後的字符串
print(s1.capitalize())   # Hello, world!
# 使用title方法獲得字符串每個單詞首字母大寫後的字符串
print(s1.title())        # Hello, World!
# 使用upper方法獲得字符串大寫後的字符串
print(s1.upper())        # HELLO, WORLD!

s2 = 'GOODBYE'
# 使用lower方法獲得字符串小寫後的字符串
print(s2.lower())        # goodbye
```

#### 查找操作

如果想在一個字符串中從前向後查找有沒有另外一個字符串，可以使用字符串的`find`或`index`方法。

```Python
s = 'hello, world!'

# find方法從字符串中查找另一個字符串所在的位置
# 找到了返回字符串中另一個字符串首字符的索引
print(s.find('or'))        # 8
# 找不到返回-1
print(s.find('shit'))      # -1
# index方法與find方法類似
# 找到了返回字符串中另一個字符串首字符的索引
print(s.index('or'))       # 8
# 找不到引發異常
print(s.index('shit'))     # ValueError: substring not found
```

在使用`find`和`index`方法時還可以通過方法的參數來指定查找的範圍，也就是查找不必從索引為`0`的位置開始。 `find`和`index`方法還有逆向查找（從後向前查找）的版本，分別是`rfind`和`rindex`，代碼如下所示。

```Python
s = 'hello good world!'

# 從前向後查找字符o出現的位置(相當於第一次出現)
print(s.find('o'))       # 4
# 從索引為5的位置開始查找字符o出現的位置
print(s.find('o', 5))    # 7
# 從後向前查找字符o出現的位置(相當於最後一次出現)
print(s.rfind('o'))      # 12
```

#### 性質判斷

可以通過字符串的`startswith`、`endswith`來判斷字符串是否以某個字符串開頭和結尾；還可以用`is`開頭的方法判斷字符串的特徵，這些方法都返回布爾值，代碼如下所示。

```Python
s1 = 'hello, world!'

# startwith方法檢查字符串是否以指定的字符串開頭返回布爾值
print(s1.startswith('He'))    # False
print(s1.startswith('hel'))   # True
# endswith方法檢查字符串是否以指定的字符串結尾返回布爾值
print(s1.endswith('!'))       # True

s2 = 'abc123456'

# isdigit方法檢查字符串是否由數字構成返回布爾值
print(s2.isdigit())    # False
# isalpha方法檢查字符串是否以字母構成返回布爾值
print(s2.isalpha())    # False
# isalnum方法檢查字符串是否以數字和字母構成返回布爾值
print(s2.isalnum())    # True
```

#### 格式化字符串

在Python中，字符串類型可以通過`center`、`ljust`、`rjust`方法做居中、左對齊和右對齊的處理。如果要在字符串的左側補零，也可以使用`zfill`方法。

```Python
s = 'hello, world'

# center方法以寬度20將字符串居中並在兩側填充*
print(s.center(20, '*'))  # ****hello, world****
# rjust方法以寬度20將字符串右對齊並在左側填充空格
print(s.rjust(20))        #         hello, world
# ljust方法以寬度20將字符串左對齊並在右側填充~
print(s.ljust(20, '~'))   # hello, world~~~~~~~~
# 在字符串的左側補零
print('33'.zfill(5))      # 00033
print('-33'.zfill(5))     # -0033
```

我們之前講過，在用`print`函數輸出字符串時，可以用下面的方式對字符串進行格式化。

```Python
a = 321
b = 123
print('%d * %d = %d' % (a, b, a * b))
```

當然，我們也可以用字符串的方法來完成字符串的格式，代碼如下所示。

```Python
a = 321
b = 123
print('{0} * {1} = {2}'.format(a, b, a * b))
```

從Python 3.6開始，格式化字符串還有更為簡潔的書寫方式，就是在字符串前加上`f`來格式化字符串，在這種以`f`打頭的字符串中，`{變量名}`是一個佔位符，會被變量對應的值將其替換掉，代碼如下所示。

```Python
a = 321
b = 123
print(f'{a} * {b} = {a * b}')
```

如果需要進一步控制格式化語法中變量值的形式，可以參照下面的表格來進行字符串格式化操作。

| 變量值      | 佔位符     | 格式化結果    | 說明 |
| ----------- | ---------- | ------------- | ---- |
| `3.1415926` | `{:.2f}`   | `'3.14'`      | 保留小數點後兩位 |
| `3.1415926` | `{:+.2f}`  | `'+3.14'`       | 帶符號保留小數點後兩位 |
| `-1`        | `{:+.2f}`  | `'-1.00'` | 帶符號保留小數點後兩位 |
| `3.1415926` | `{:.0f}`   | `'3'` | 不帶小數 |
| `123`       | `{:0>10d}` | `'0000000123'` | 左邊補`0`，補夠10位 |
| `123`       | `{:x<10d}` | `'123xxxxxxx'` | 右邊補`x` ，補夠10位 |
| `123`       | `{:>10d}`  | `'       123'` | 左邊補空格，補夠10位 |
| `123`       | `{:<10d}` | `'123       '` | 右邊補空格，補夠10位 |
| `123456789` | `{:,}`     | `'123,456,789'` | 逗號分隔格式 |
| `0.123`     | `{:.2%}`   | `'12.30%'`    | 百分比格式 |
| `123456789` | `{:.2e}`   | `'1.23e+08'`  | 科學計數法格式 |

#### 修剪操作

字符串的`strip`方法可以幫我們獲得將原字符串修剪掉左右兩端空格之後的字符串。這個方法非常有實用價值，通常用來將用戶輸入中因為不小心鍵入的頭尾空格去掉，`strip`方法還有`lstrip`和`rstrip`兩個版本，相信從名字大家已經猜出來這兩個方法是做什麼用的。

```Python
s = '   jackfrued@126.com  \t\r\n'
# strip方法獲得字符串修剪左右兩側空格之後的字符串
print(s.strip())    # jackfrued@126.com
```

#### 替換操作

如果希望用新的內容替換字符串中指定的內容，可以使用`replace`方法，代碼如下所示。 `replace`方法的第一個參數是被替換的內容，第二個參數是替換後的內容，還可以通過第三個參數指定替換的次數。

```Python
s = 'hello, world'
print(s.replace('o', '@'))     # hell@, w@rld
print(s.replace('o', '@', 1))  # hell@, world
```

#### 拆分/合併操作

可以使用字符串的`split`方法將一個字符串拆分為多個字符串（放在一個列表中），也可以使用字符串的`join`方法將列表中的多個字符串連接成一個字符串，代碼如下所示。

```Python
s = 'I love you'
words = s.split()
print(words)            # ['I', 'love', 'you']
print('#'.join(words))  # I#love#you
```

需要說明的是，`split`方法默認使用空格進行拆分，我們也可以指定其他的字符來拆分字符串，而且還可以指定最大拆分次數來控制拆分的效果，代碼如下所示。

```Python
s = 'I#love#you#so#much'
words = s.split('#')
print(words)  # ['I', 'love', 'you', 'so', 'much']
words = s.split('#', 3)
print(words)  # ['I', 'love', 'you', 'so#much']
```

#### 編碼/解碼操作

Python中除了字符串`str`類型外，還有一種表示二進制數據的字節串類型（`bytes`）。所謂字節串，就是**由零個或多個字節組成的有限序列**。通過字符串的`encode`方法，我們可以按照某種編碼方式將字符串編碼為字節串，我們也可以使用字節串的`decode`方法，將字節串解碼為字符串，代碼如下所示。

```Python
a = '駱昊'
b = a.encode('utf-8')
c = a.encode('gbk')
print(b, c)  # b'\xe9\xaa\x86\xe6\x98\x8a' b'\xc2\xe6\xea\xbb'
print(b.decode('utf-8'))
print(c.decode('gbk'))
```

注意，如果編碼和解碼的方式不一致，會導致亂碼問題（無法再現原始的內容）或引發`UnicodeDecodeError`錯誤導致程序崩潰。

#### 其他方法

對於字符串類型來說，還有一個常用的操作是對字符串進行匹配檢查，即檢查字符串是否滿足某種特定的模式。例如，一個網站對用戶註冊信息中用戶名和郵箱的檢查，就屬於模式匹配檢查。實現模式匹配檢查的工具叫做正則表達式，Python語言通過標準庫中的`re`模塊提供了對正則表達式的支持，我們會在後續的課程中為大家講解這個知識點。

### 簡單的總結

知道如何表示和操作字符串對程序員來說是非常重要的，因為我們需要處理文本信息，Python中操作字符串可以用拼接、切片等運算符，也可以使用字符串類型的方法。
